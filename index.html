<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ì—Ä—É–∑—ñ—è ‚úàÔ∏è ‚Äî –∂–µ—Ä–µ–±–∫—É–≤–∞–Ω–Ω—è —á–æ—Ö–ª—ñ–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Inter", "ui-sans-serif", "system-ui"] },
          },
        },
      };
    </script>
    <style>
      .bg-grid {
        background-image: radial-gradient(
          rgba(0, 0, 0, 0.06) 1px,
          transparent 1px
        );
        background-size: 12px 12px;
      }
    </style>
  </head>
  <body
    class="min-h-dvh bg-gradient-to-br from-amber-50 via-white to-sky-50 text-slate-800"
  >
    <header class="max-w-5xl mx-auto px-4 sm:px-6 pt-10 pb-6">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h1 class="text-3xl sm:text-4xl font-bold tracking-tight">
            –ì—Ä—É–∑—ñ—è ‚úàÔ∏è ‚Äî –∂–µ—Ä–µ–±–∫—É–≤–∞–Ω–Ω—è —á–æ—Ö–ª—ñ–≤
          </h1>
          <p class="mt-2 text-slate-600 max-w-2xl">
            ¬´–ü–∞—Å–ø–æ—Ä—Ç —î? –ù–∞—Å—Ç—Ä—ñ–π —î? –í–∏–Ω–æ —Ç–µ–∂ –∑–Ω–∞–π–¥–µ—Ç—å—Å—è!¬ª ‚Äî –∞ –≤ –Ω–∞—Å —â–µ
            <span class="font-semibold">—Å–ø–æ—Ä—Ç–∏–≤–Ω–æ-–∞–ª–∫–æ–≥–æ–ª—å–Ω–∏–π –∑–∞–±—ñ–≥</span>.
            –ì–æ–ª–æ–≤–Ω–µ –ø—Ä–∞–≤–∏–ª–æ: –Ω–µ –¥–∞—Ä—É—î–º–æ —Å–æ–±—ñ –∞–±–æ —Å–≤–æ—ó–π –ø–æ–ª–æ–≤–∏–Ω—Ü—ñ, —ñ–Ω–∞–∫—à–µ —à—Ç—Ä–∞—Ñ–Ω–µ
            –°–∞–ø–µ—Ä–∞–≤—ñ üç∑
          </p>
        </div>
      </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 sm:px-6 pb-24">
      <section class="grid md:grid-cols-2 gap-6">
        <!-- Admin inputs -->
        <div
          id="inputSection"
          class="bg-white/80 backdrop-blur rounded-3xl border border-slate-200 p-5 md:p-6 shadow-sm"
        >
          <h2 class="text-lg font-semibold flex items-center gap-2">
            üë• –£—á–∞—Å–Ω–∏–∫–∏
          </h2>
          <p class="text-sm text-slate-600 mt-1">
            –ü–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ä—è–¥–æ–∫. –ú—ñ–Ω—ñ–º—É–º 3 –æ—Å–æ–±–∏. –î–ª—è –º–æ–¥–µ–ª—ñ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ñ–æ—Ä–º–∞—Ç "–Ü–º'—è —Ç–µ–ª–µ—Ñ–æ–Ω: –º–æ–¥–µ–ª—å". (–ë–∞—á–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä)
          </p>
          <textarea
            id="participants"
            class="mt-3 w-full min-h-44 rounded-2xl border border-slate-300 p-3"
            placeholder="–Ü–≤–∞–Ω
–ú–∞—Ä—ñ—è —Ç–µ–ª–µ—Ñ–æ–Ω: iPhone 13 Pro
–ê–Ω–¥—Ä—ñ–π —Ç–µ–ª–µ—Ñ–æ–Ω: Samsung Galaxy S23
–û–ª–µ–Ω–∞
..."
          ></textarea>

          <div class="mt-6">
            <h3 class="text-base font-semibold">
              üíû –ü–∞—Ä–∏ (—â–æ–± –Ω–µ –¥–∞—Ä—É–≤–∞–ª–∏ –æ–¥–Ω–µ –æ–¥–Ω–æ–º—É)
            </h3>
            <p class="text-sm text-slate-600 mt-1">
              –§–æ—Ä–º–∞—Ç: <code>–Ü–º º—è A - –Ü–º º—è B</code> –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ä—è–¥–æ–∫.
            </p>
            <textarea
              id="pairs"
              class="mt-3 w-full min-h-28 rounded-2xl border border-slate-300 p-3"
              placeholder="–ú–∞—Ä—ñ—è - –Ü–≤–∞–Ω
–û–ª–µ–Ω–∞ - –°–µ—Ä–≥—ñ–π"
            ></textarea>
          </div>

          <div class="mt-6 flex flex-wrap items-center gap-3">
            <button
              id="drawBtn"
              class="px-4 py-2.5 rounded-2xl bg-sky-600 text-white font-medium hover:bg-sky-700 active:translate-y-px shadow"
            >
              –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∂–µ—Ä–µ–±–∫—É–≤–∞–Ω–Ω—è
            </button>
          </div>
          <p class="mt-3 text-xs text-slate-500">
            –ü–æ—Ä–∞–¥–∞: —è–∫—â–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤ –±–∞–≥–∞—Ç–æ —ñ –ø–∞—Ä —Ç–µ–∂ ‚Äî —ñ–Ω–æ–¥—ñ —Ä—ñ—à–µ–Ω–Ω—è –Ω–µ —ñ—Å–Ω—É—î.
            –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑ –∞–±–æ —Ç—Ä–æ—Ö–∏ –∑–º—ñ–Ω—ñ—Ç—å –ø–∞—Ä–∏.
          </p>
        </div>

        <!-- Admin result -->
        <div
          class="bg-white/80 backdrop-blur rounded-3xl border border-slate-200 p-5 md:p-6 shadow-sm"
        >
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold">üéÅ –†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
            <div
              id="seedTag"
              class="hidden text-xs px-2 py-1 rounded-xl bg-amber-100 text-amber-900 border border-amber-200"
            ></div>
          </div>
          <div id="result" class="mt-4 grid sm:grid-cols-2 gap-3"></div>
          <div id="emptyState" class="mt-6 text-slate-500 text-sm">
            –ù–∞—Ç–∏—Å–∫–∞–π ¬´–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∂–µ—Ä–µ–±–∫—É–≤–∞–Ω–Ω—è¬ª, –∞ –ø–æ—Ç—ñ–º ‚Äî –∑–≥–µ–Ω–µ—Ä—É–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ
            –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —É—á–∞—Å–Ω–∏–∫–∞.
          </div>

          <!-- Links area -->
          <div id="linksWrap" class="mt-6 hidden">
            <h3 class="font-semibold">üîó –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</h3>
            <p class="text-sm text-slate-600 mt-1">
              –ù–∞–¥—ñ—à–ª–∏ –∫–æ–∂–Ω–æ–º—É —Å–≤–æ—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è ‚Äî —Ç–∞–º –±—É–¥–µ –≤–∏–¥–Ω–æ –ª–∏—à–µ —ó—Ö–Ω—ñ–π
              –æ—Ç—Ä–∏–º—É–≤–∞—á.
            </p>
            <div class="mt-3 overflow-x-auto">
              <table
                class="w-full text-sm border border-slate-200 rounded-2xl overflow-hidden"
              >
                <thead class="bg-slate-50 text-slate-600">
                  <tr>
                    <th class="text-left p-2">–£—á–∞—Å–Ω–∏–∫</th>
                    <th class="text-left p-2">–û—Ç—Ä–∏–º–∞—î</th>
                    <th class="text-left p-2">–ü–æ—Å–∏–ª–∞–Ω–Ω—è</th>
                    <th class="text-left p-2">–î—ñ—è</th>
                  </tr>
                </thead>
                <tbody
                  id="linksTbody"
                  class="divide-y divide-slate-200"
                ></tbody>
              </table>
            </div>
            <div class="mt-4 flex flex-wrap gap-3">
              <button
                id="downloadPublicBtn"
                class="px-4 py-2.5 rounded-2xl bg-emerald-600 text-white font-medium hover:bg-emerald-700 shadow"
              >
                –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ (result.html)
              </button>
              <button
                id="copyAllBtn"
                class="px-4 py-2.5 rounded-2xl bg-white border border-slate-300 font-medium hover:bg-slate-50"
              >
                –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Å—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
              </button>
            </div>
            <p class="mt-2 text-xs text-slate-500">
              result.html ‚Äî –ø–æ–∫–∞–∑—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ª–∏—à–µ —Ç–∏–º, —É –∫–æ–≥–æ —î
              <span class="font-semibold">—Å–µ–∫—Ä–µ—Ç–Ω–∏–π —Ç–æ–∫–µ–Ω</span> –≤ –∞–¥—Ä–µ—Å—ñ (–ø—ñ—Å–ª—è
              #).
            </p>
          </div>
        </div>
      </section>

      <section class="mt-8">
        <div class="bg-grid rounded-3xl border border-slate-200 p-5 md:p-6">
          <ul
            class="mt-2 grid sm:grid-cols-2 lg:grid-cols-3 gap-2 text-sm text-slate-700"
          >
            <li>üç∑ ¬´–ó–∞ –ì—Ä—É–∑—ñ—é! –©–æ–± –Ω–æ–≥–∏ –±—ñ–≥–ª–∏ —à–≤–∏–¥—à–µ, –Ω—ñ–∂ –ø–æ—Ö–º—ñ–ª–ª—è.¬ª</li>
            <li>
              üõ´ ¬´–õ–µ—Ç–∏–º–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏, —á–∏ –ø—Ä–∞—Ü—é—î –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è –ø—ñ—Å–ª—è –°–∞–ø–µ—Ä–∞–≤—ñ.¬ª
            </li>
            <li>üèÜ ¬´–¢—Ä–∏ –∫—Ä–æ–∫–∏ –¥–æ –ø–µ—Ä–µ–º–æ–≥–∏: –≤–∏–ª–µ—Ç—ñ—Ç–∏, –≤–∏–ø–∏—Ç–∏, –≤–∏–∂–∏—Ç–∏.¬ª</li>
            <li>üèÉ‚Äç‚ôÇÔ∏è ¬´–ë—ñ–≥ —É –≥–æ—Ä–∞—Ö ‚Äî —Ü–µ –∫–æ–ª–∏ –ø—ñ–¥–π–æ–º —Ç—Ä–∏–≤–∞—î —Ä—ñ–≤–Ω–æ —Ç—Ä–∏ —Ç–æ—Å—Ç–∏.¬ª</li>
            <li>üçë ¬´–ö–∞–≤–∫–∞–∑—å–∫—ñ –ø–µ—Ä—Å–∏–∫–∏ ‚Äî —è–∫ –º–∏: —Å–æ–ª–æ–¥–∫—ñ, –∞–ª–µ –∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º.¬ª</li>
            <li>üçæ ¬´–í –∞–µ—Ä–æ–ø–æ—Ä—Ç—É —Ç–∏—Ö–æ, –¥–æ–∫–∏ –º–∏ –Ω–µ –ø—Ä–∏—ó—Ö–∞–ª–∏.¬ª</li>
            <li>üö¥‚Äç‚ôÇÔ∏è ¬´–í–∏–Ω–æ –≤ –ø–ª—è—à—Ü—ñ ‚Äî —Ü–µ —Ç–µ–∂ —Å–ø–æ—Ä—Ç, –±–æ –π–æ–≥–æ —Ç—Ä–µ–±–∞ –Ω–µ—Å—Ç–∏.¬ª</li>
            <li>üèîÔ∏è ¬´–ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ—Å—Ç–∏–π: –≥–æ—Ç–µ–ª—å ‚Üí –≥–æ—Ä–∏ ‚Üí –≤–∏–Ω–Ω–∏–π –±–∞—Ä.¬ª</li>
            <li>ü•ü ¬´–•—ñ–Ω–∫–∞–ª—ñ ‚Äî —Ü–µ –∫–∞—Ä–¥—ñ–æ –¥–ª—è —â–µ–ª–µ–ø.¬ª</li>
            <li>
              ü•Ç ¬´–ü–µ—Ä—à–∏–π —Ç–æ—Å—Ç ‚Äî –∑–∞ –≤–∏–ª—ñ—Ç, –¥—Ä—É–≥–∏–π ‚Äî —â–æ–± –¥–æ–ª–µ—Ç—ñ–ª–∏, —Ç—Ä–µ—Ç—ñ–π ‚Äî —â–æ–±
              –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è.¬ª
            </li>
            <li>üõ¨ ¬´–ú‚Äô—è–∫–∞ –ø–æ—Å–∞–¥–∫–∞ ‚Äî —Ü–µ –∫–æ–ª–∏ —Å–ø–∏—à –≤–∂–µ –Ω–∞ —Ç—Ä–∞–ø—ñ.¬ª</li>
            <li>üçá ¬´–°–∞–ø–µ—Ä–∞–≤—ñ –Ω–µ –ø–∏—Ç–∞—î, –≥–æ—Ç–æ–≤–∏–π —Ç–∏ —á–∏ –Ω—ñ.¬ª</li>
            <li>üíÉ ¬´–ì—Ä—É–∑–∏–Ω—Å—å–∫—ñ —Ç–∞–Ω—Ü—ñ: –∫—Ä–æ–∫ –≤–ª—ñ–≤–æ —ñ —Ç—Ä–∏ –∫–æ–≤—Ç–∫–∏ –≤–ø—Ä–∞–≤–æ.¬ª</li>
            <li>üß≥ ¬´–ì–æ–ª–æ–≤–Ω–µ ‚Äî –Ω–µ –∑–∞–≥—É–±–∏—Ç–∏ –±–∞–≥–∞–∂ —ñ –¥—Ä—É–≥–∞ –∑ –±–∞—Ä—É.¬ª</li>
            <li>üß≠ ¬´–Ø–∫—â–æ –∑–∞–±–ª—É–∫–∞–≤ ‚Äî –π–¥–∏ –Ω–∞ –∑–≤—É–∫ —Ç–æ—Å—Ç—ñ–≤.¬ª</li>
          </ul>
        </div>
      </section>
    </main>

    <footer
      class="max-w-5xl mx-auto px-4 sm:px-6 pb-10 text-center text-xs text-slate-500"
    >
      –ó –ª—é–±–æ–≤ º—é –¥–æ –ø–æ–¥–æ—Ä–æ–∂–µ–π —ñ –¥—Ä—É–∑—ñ–≤ ‚Ä¢ ¬´–ì–æ–ª–æ–≤–Ω–µ ‚Äî –Ω–µ –∑–∞–≥—É–±–∏—Ç–∏ –±–∞–≥–∞–∂ —ñ –ø–æ—á—É—Ç—Ç—è
      –≥—É–º–æ—Ä—É¬ª üíô
    </footer>

    <script>
      // ===== Helpers =====
      function mulberry32(a) {
        return function () {
          let t = (a += 0x6d2b79f5);
          t = Math.imul(t ^ (t >>> 15), t | 1);
          t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
          return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
        };
      }
      function shuffle(arr, rand) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rand() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }
      const norm = (s) => s.trim().replace(/\s+/g, " ");
      function parseParticipants(raw) {
        function parseLine(line) {
          line = norm(line);
          if (!line) return null;
          
          // Check for "—Ç–µ–ª–µ—Ñ–æ–Ω:" pattern first
          const phoneMatch = line.match(/^(.+?)\s+—Ç–µ–ª–µ—Ñ–æ–Ω:\s*(.+)$/i);
          if (phoneMatch) {
            return { name: norm(phoneMatch[1]), model: norm(phoneMatch[2]) };
          }
          
          // 1) "Name (Model)"
          const mParen = line.match(/^(.+?)\s*\((.+?)\)\s*$/);
          if (mParen) {
            return { name: norm(mParen[1]), model: norm(mParen[2]) };
          }
          // 2) "Name - Model" / "Name ‚Äî Model" / "Name ‚Äì Model" / "Name | Model"
          const parts = line.split(/\s*[|‚Äî‚Äì-]\s*/);
          if (parts.length >= 2) {
            return {
              name: norm(parts[0]),
              model: norm(parts.slice(1).join(" - ")),
            };
          }
          // 3) Just a name
          return { name: line, model: "" };
        }
        return raw
          .split(/\n|,/)
          .map(parseLine)
          .filter(Boolean)
          .filter((p) => p.name);
      }
      function parsePairs(raw) {
        const pairs = [];
        raw.split(/\n/).forEach((line) => {
          if (!line.trim()) return;
          const m = line.split(/-|‚Äî|‚Äì|:/);
          if (m.length >= 2) {
            const a = norm(m[0]);
            const b = norm(m.slice(1).join("-"));
            if (a && b) pairs.push([a, b]);
          }
        });
        return pairs;
      }
      function buildForbidden(names, pairs) {
        const idx = new Map(names.map((n, i) => [n, i]));
        const forb = Array.from({ length: names.length }, () => new Set());
        names.forEach((_, i) => forb[i].add(i));
        for (const [a, b] of pairs) {
          if (!idx.has(a) || !idx.has(b)) continue;
          const i = idx.get(a),
            j = idx.get(b);
          forb[i].add(j);
          forb[j].add(i);
        }
        return forb;
      }
      function secretSanta(names, forb, rand) {
        const n = names.length;
        const options = Array.from({ length: n }, (_, i) => {
          const o = [];
          for (let j = 0; j < n; j++) if (!forb[i].has(j)) o.push(j);
          return o;
        });
        for (let i = 0; i < n; i++) if (options[i].length === 0) return null;
        const order = Array.from({ length: n }, (_, i) => i).sort(
          (a, b) => options[a].length - options[b].length
        );
        const used = Array(n).fill(false);
        const recv = Array(n).fill(-1);
        function dfs(pos) {
          if (pos === n) return true;
          const i = order[pos];
          const pool = options[i].filter((j) => !used[j]);
          if (pool.length === 0) return false;
          shuffle(pool, rand);
          for (const j of pool) {
            used[j] = true;
            recv[i] = j;
            if (dfs(pos + 1)) return true;
            used[j] = false;
            recv[i] = -1;
          }
          return false;
        }
        return dfs(0) ? recv : null;
      }
      function uid() {
        const arr = new Uint8Array(16);
        if (crypto?.getRandomValues) crypto.getRandomValues(arr);
        else {
          const r = mulberry32(Date.now() >>> 0);
          for (let i = 0; i < 16; i++) arr[i] = Math.floor(r() * 256);
        }
        return Array.from(arr, (b) => b.toString(16).padStart(2, "0")).join("");
      }

      // ===== UI Refs =====
      const els = {
        participants: document.getElementById("participants"),
        pairs: document.getElementById("pairs"),
        drawBtn: document.getElementById("drawBtn"),
        result: document.getElementById("result"),
        emptyState: document.getElementById("emptyState"),
        seedTag: document.getElementById("seedTag"),
        linksWrap: document.getElementById("linksWrap"),
        linksTbody: document.getElementById("linksTbody"),
        downloadPublicBtn: document.getElementById("downloadPublicBtn"),
        copyAllBtn: document.getElementById("copyAllBtn"),
      };

      let current = {
        names: [], // participant names only
        models: [], // phone models aligned by index
        pairs: [],
        recv: null,
        seed: null,
        tokens: [],
      };

      function showResult(names, recvIdx, seed) {
        const box = els.result,
          empty = els.emptyState,
          seedTag = els.seedTag;
        box.innerHTML = "";
        if (!recvIdx) {
          empty.classList.remove("hidden");
          seedTag.classList.add("hidden");
          return;
        }
        empty.classList.add("hidden");
        seedTag.textContent = `seed: ${seed}`;
        seedTag.classList.remove("hidden");
        const cards = [];
        for (let i = 0; i < names.length; i++) {
          const giver = names[i];
          const rIdx = recvIdx[i];
          const receiver = names[rIdx];
          const receiverModel = (current.models || [])[rIdx] || "";
          cards.push(`<div class="rounded-2xl border border-slate-200 bg-white p-3 flex items-center gap-3 shadow-sm">
          <div class="text-2xl">üç∑</div>
          <div class="min-w-0"><div class="text-sm text-slate-500">–î–∞—Ä—É—î</div><div class="font-semibold truncate">${giver}</div></div>
          <div class="mx-auto text-slate-400">‚Üí</div>
          <div class="min-w-0 text-right">
            <div class="text-sm text-slate-500">–û—Ç—Ä–∏–º–∞—î</div>
            <div class="font-semibold truncate">${receiver}</div>
            ${
              receiverModel
                ? `<div class="text-xs text-slate-500 truncate">${receiverModel}</div>`
                : ``
            }
          </div>
        </div>`);
        }
        box.innerHTML = cards.join("");
      }

      function freezeInputs() {
        els.participants.disabled = true;
        els.pairs.disabled = true;
        els.drawBtn.disabled = true;
        els.participants.classList.add("opacity-60", "cursor-not-allowed");
        els.pairs.classList.add("opacity-60", "cursor-not-allowed");
      }

      function buildLinksTable() {
        const base = "result.html#";
        const rows = [];
        const links = [];
        for (let i = 0; i < current.names.length; i++) {
          const giver = current.names[i];
          const rIdx = current.recv[i];
          const receiver = current.names[rIdx];
          const receiverModel = (current.models || [])[rIdx] || "";
          const token = current.tokens[i];
          const url = base + token;
          links.push(`${giver}: ${url}`);
          rows.push(`<tr>
          <td class="p-2">${giver}</td>
          <td class="p-2">
            <div class="font-medium">${receiver}</div>
            ${
              receiverModel
                ? `<div class="text-xs text-slate-500">${receiverModel}</div>`
                : ``
            }
          </td>
          <td class="p-2 break-all"><span class="inline-flex items-center gap-2">${url}</span></td>
          <td class="p-2"><button data-url="${url}" class="copyOne px-3 py-1.5 rounded-xl bg-white border border-slate-300 hover:bg-slate-50 text-xs">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏</button></td>
        </tr>`);
        }
        els.linksTbody.innerHTML = rows.join("");
        els.linksWrap.classList.remove("hidden");

        // –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–Ω–æ–ø–∫–µ
        document.querySelectorAll(".copyOne").forEach((btn) => {
          btn.addEventListener("click", async () => {
            try {
              await navigator.clipboard.writeText(btn.dataset.url);
              btn.textContent = "–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!";
              setTimeout(() => (btn.textContent = "–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏"), 1200);
            } catch {
              alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ :(");
            }
          });
        });
        // –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫
        els.copyAllBtn.onclick = async () => {
          try {
            await navigator.clipboard.writeText(links.join("\n"));
            alert("–£—Å—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ");
          } catch {
            alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ :(");
          }
        };
      }

      function downloadResultHtml() {
        // –∫–∞—Ä—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤: token -> { giver, receiver, receiverModel }
        const map = Object.fromEntries(
          current.names.map((g, i) => {
            const rIdx = current.recv[i];
            return [
              current.tokens[i],
              {
                giver: g,
                receiver: current.names[rIdx],
                receiverModel: (current.models || [])[rIdx] || "",
              },
            ];
          })
        );
        const payload = JSON.stringify(map);

        const html =
          `<!doctype html>
<html lang="uk"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ì—Ä—É–∑—ñ—è ‚úàÔ∏è ‚Äî —Ç–≤—ñ–π –ø–æ–¥–∞—Ä—É–Ω–æ–∫</title>
<script src="https://cdn.tailwindcss.com"><\/script>
<style>body{min-height:100dvh}</style>
</head><body class="bg-gradient-to-br from-white via-amber-50 to-sky-50 text-slate-800">
<main class="max-w-xl mx-auto p-6">
  <div class="rounded-3xl border border-slate-200 bg-white/80 backdrop-blur p-6 shadow-sm">
    <h1 class="text-2xl font-bold">–ö–æ–º—É –¥–∞—Ä—É—î—à üéÅ</h1>
    <p class="mt-2 text-slate-600 text-sm">–¶—é —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤–∏–¥–Ω–æ —Ç—ñ–ª—å–∫–∏ —Ç–∏–º, —Ö—Ç–æ –º–∞—î —Å–µ–∫—Ä–µ—Ç–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.</p>
    <div id="box" class="mt-6"></div>
    <div class="mt-8 p-4 rounded-2xl bg-amber-50 border border-amber-200">
      <h3 class="text-sm font-semibold text-amber-800 mb-3">üç∑ –ú–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω—ñ —Ñ—Ä–∞–∑–∏ –≤—ñ–¥ –∫–æ–º–∞–Ω–¥–∏</h3>
      <div class="grid gap-2 text-xs text-amber-700">
        <div>üç∑ ¬´–ó–∞ –ì—Ä—É–∑—ñ—é! –©–æ–± –Ω–æ–≥–∏ –±—ñ–≥–ª–∏ —à–≤–∏–¥—à–µ, –Ω—ñ–∂ –ø–æ—Ö–º—ñ–ª–ª—è.¬ª</div>
        <div>üõ´ ¬´–õ–µ—Ç–∏–º–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏, —á–∏ –ø—Ä–∞—Ü—é—î –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—è –ø—ñ—Å–ª—è –°–∞–ø–µ—Ä–∞–≤—ñ.¬ª</div>
        <div>üèÜ ¬´–¢—Ä–∏ –∫—Ä–æ–∫–∏ –¥–æ –ø–µ—Ä–µ–º–æ–≥–∏: –≤–∏–ª–µ—Ç—ñ—Ç–∏, –≤–∏–ø–∏—Ç–∏, –≤–∏–∂–∏—Ç–∏.¬ª</div>
        <div>üèÉ‚Äç‚ôÇÔ∏è ¬´–ë—ñ–≥ —É –≥–æ—Ä–∞—Ö ‚Äî —Ü–µ –∫–æ–ª–∏ –ø—ñ–¥–π–æ–º —Ç—Ä–∏–≤–∞—î —Ä—ñ–≤–Ω–æ —Ç—Ä–∏ —Ç–æ—Å—Ç–∏.¬ª</div>
        <div>üçë ¬´–ö–∞–≤–∫–∞–∑—å–∫—ñ –ø–µ—Ä—Å–∏–∫–∏ ‚Äî —è–∫ –º–∏: —Å–æ–ª–æ–¥–∫—ñ, –∞–ª–µ –∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º.¬ª</div>
        <div>üçæ ¬´–í –∞–µ—Ä–æ–ø–æ—Ä—Ç—É —Ç–∏—Ö–æ, –¥–æ–∫–∏ –º–∏ –Ω–µ –ø—Ä–∏—ó—Ö–∞–ª–∏.¬ª</div>
      </div>
    </div>
    <div class="mt-6 text-xs text-slate-500">–ü–æ—Ä–∞–¥–∞: –Ω–µ –¥—ñ–ª—ñ—Ç—å—Å—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º, —è–∫—â–æ –Ω–µ —Ö–æ—á–µ—Ç–µ —Å–ø–æ–π–ª–µ—Ä—ñ–≤ üòâ</div>
  </div>
</main>
<scr` +
          `ipt>
const MAP = ${payload};
function render(){
  const token = location.hash.replace('#','').trim();
  const box = document.getElementById('box');
  if(!token || !MAP[token]){ box.innerHTML = '<div class="text-slate-600">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ –∞–±–æ –∑–∞—Å—Ç–∞—Ä—ñ–ª–µ.</div>'; return; }
  const {giver, receiver, receiverModel} = MAP[token];
  box.innerHTML = \`<div class="space-y-3">
    <div class="flex items-center gap-3">
      <div class="text-3xl">üß≥</div>
      <div>
        <div class="text-slate-500 text-sm">–ü—Ä–∏–≤—ñ—Ç, <span class="font-semibold">\${giver}</span>!</div>
        <div class="mt-1">
          <div class="text-slate-500 text-sm">–¢–∏ –¥–∞—Ä—É—î—à —á–æ—Ö–æ–ª –¥–ª—è:</div>
          <div class="text-lg font-semibold underline decoration-dotted">\${receiver}</div>
          \${receiverModel ? \`<div class="mt-1 px-2 py-1 bg-blue-50 border border-blue-200 rounded-lg inline-block"><span class="text-blue-600 text-xs font-medium">üì± \${receiverModel}</span></div>\` : ''}
        </div>
      </div>
    </div>
    <div class="text-sm text-slate-600">–¢—Å-—Å! –ù–µ –ø–æ–∫–∞–∑—É–π —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É —ñ–Ω—à–∏–º üòâ</div>
  </div>\`;
}
window.addEventListener('hashchange', render); render();
<\/script>
</body></html>`;

        const blob = new Blob([html], { type: "text/html" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "result.html";
        a.click();
        URL.revokeObjectURL(url);
      }

      function runDraw() {
        const people = parseParticipants(els.participants.value);
        const names = people.map((p) => p.name);
        const pairs = parsePairs(els.pairs.value);
        if (names.length < 3) {
          alert("–ü–æ—Ç—Ä—ñ–±–Ω–æ —â–æ–Ω–∞–π–º–µ–Ω—à–µ 3 —É—á–∞—Å–Ω–∏–∫–∏.");
          return;
        }

        const validPairs = pairs.filter(
          ([a, b]) => names.includes(a) && names.includes(b)
        );
        const forb = buildForbidden(names, validPairs);
        const rng = mulberry32(Date.now() >>> 0);

        let recv = null;
        for (let k = 0; k < 200 && !recv; k++) {
          for (let s = 0; s < k % 7; s++) rng();
          recv = secretSanta(names, forb, rng);
        }
        if (!recv) {
          alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª. –ó–º—ñ–Ω—ñ—Ç—å –ø–∞—Ä–∏.");
          return;
        }

        current = {
          names,
          models: people.map((p) => p.model || ""),
          pairs: validPairs,
          recv,
          seed: Date.now() >>> 0,
          tokens: [],
        };
        showResult(names, recv, current.seed);

        // –±–ª–æ–∫–∏—Ä—É–µ–º –≤–≤–æ–¥
        els.participants.disabled = true;
        els.pairs.disabled = true;
        els.drawBtn.disabled = true;
        els.participants.classList.add("opacity-60", "cursor-not-allowed");
        els.pairs.classList.add("opacity-60", "cursor-not-allowed");

        // –≥–µ–Ω–µ—Ä–∏–º —Ç–æ–∫–µ–Ω—ã –∏ —Ç–∞–±–ª–∏—Ü—É —Å—Å—ã–ª–æ–∫
        current.tokens = current.names.map(() => uid());
        buildLinksTable();
      }

      els.drawBtn.addEventListener("click", runDraw);
      els.downloadPublicBtn.addEventListener("click", () => {
        if (!current.recv || !current.tokens.length) {
          alert("–°–ø–æ—á–∞—Ç–∫—É –∑–≥–µ–Ω–µ—Ä—É–π—Ç–µ –∂–µ—Ä–µ–±–∫—É–≤–∞–Ω–Ω—è —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è!");
          return;
        }
        downloadResultHtml();
      });
    </script>
  </body>
</html>
